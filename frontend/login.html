<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | ClipSummary</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="icon" type="image/svg+xml" href="images/favicons/favicon.svg">
</head>
<body>
    <div class="auth-container">
        <div class="auth-box">
            <h1 class="auth-title">Welcome Back</h1>
            <div id="error-message" class="error-message"></div>
            <div id="success-message" class="success-message"></div>
            
            <form id="login-form" class="auth-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block login-btn">
                    <span>Login</span>
                    <svg class="login-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15.555 12.9688C15.789 12.7344 15.789 12.3047 15.555 12.0703L10.5547 7.0703C10.3203 6.8359 9.8906 6.8359 9.6562 7.0703C9.4219 7.3047 9.4219 7.7344 9.6562 7.9688L13.6016 11.875H2.625C2.2734 11.875 2 12.1875 2 12.5C2 12.8516 2.2734 13.125 2.625 13.125H13.6016L9.6562 17.0703C9.4219 17.3047 9.4219 17.7344 9.6562 17.9688C9.8906 18.2031 10.3203 18.2031 10.5547 17.9688L15.555 12.9688ZM15.125 20C14.773 20 14.5 20.3125 14.5 20.625C14.5 20.9766 14.773 21.25 15.125 21.25H18.875C20.594 21.25 22 19.8828 22 18.125V6.875C22 5.1562 20.594 3.75 18.875 3.75H15.125C14.773 3.75 14.5 4.0625 14.5 4.375C14.5 4.7266 14.773 5 15.125 5H18.875C19.891 5 20.75 5.8594 20.75 6.875V18.125C20.75 19.1797 19.891 20 18.875 20H15.125Z" fill="#C9CED6"/>
                    </svg>
                </button>
            </form>
            
            <div class="auth-footer">
                <p>Don't have an account? <a href="signup.html">Sign Up</a></p>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new URLSearchParams();
            formData.append('username', document.getElementById('username').value);
            formData.append('password', document.getElementById('password').value);
            
            const errorEl = document.getElementById('error-message');
            const successEl = document.getElementById('success-message');
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Store tokens
                    localStorage.setItem('access_token', data.access_token);
                    localStorage.setItem('token_type', data.token_type);
                    
                    // Check if there's a redirect URL in the query params
                    const params = new URLSearchParams(window.location.search);
                    const redirect = params.get('redirect');
                    
                    // Redirect to the previous page or home
                    window.location.href = redirect || '/';
                } else {
                    errorEl.textContent = data.detail || 'Login failed';
                    errorEl.style.display = 'block';
                    successEl.style.display = 'none';
                }
            } catch (error) {
                console.error('Login error:', error);
                errorEl.textContent = 'An error occurred during login. Please try again.';
                errorEl.style.display = 'block';
                successEl.style.display = 'none';
            }
        });
        
        // Check for registration success message
        window.addEventListener('load', function() {
            const params = new URLSearchParams(window.location.search);
            const registered = params.get('registered');
            
            if (registered) {
                const successEl = document.getElementById('success-message');
                successEl.textContent = 'Registration successful! Please login with your credentials.';
                successEl.style.display = 'block';
            }
        });
    </script>
</body>
</html>